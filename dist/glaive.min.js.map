{"version":3,"file":"glaive.min.js","sources":["../lib/isType.js","../src/DI.js","../src/Module.js","../src/index.js"],"sourcesContent":["export default new Proxy(\n  {},\n  {\n    get: (target, name) => value =>\n      value::Object.prototype.toString() === `[object ${name}]`,\n  },\n)\n","import is from \"../lib/isType\"\n\nexport default class DI {\n  constructor(config) {\n    this._config = config\n    this._modules = []\n    this._module = {}\n    this.initialize()\n    this.bootstrap().then()\n  }\n\n  _queue(modules, list) {\n    let restModules = []\n    modules.map(({ moduleName, dependence = [] }) => {\n      const isNoneDependence = dependence.length === 0\n      const rest = [...new Set(dependence.concat(list))].filter(\n        item => !list.includes(item),\n      )\n      const isDepended = rest.length === 0\n      if (isNoneDependence || isDepended) {\n        list.push(moduleName)\n      } else {\n        restModules.push({ moduleName, dependence })\n      }\n    })\n    if (restModules.length > 0) {\n      this._queue(restModules, list)\n    }\n  }\n\n  _filter(injected, dependencie, injectedDependencies) {\n    return dependencie\n      .map((item, index) => ({\n        moduleName: item,\n        module: injected[index],\n      }))\n      .filter(({ moduleName }) => injectedDependencies.includes(moduleName))\n      .map(({ module }) => module)\n  }\n\n  initialize() {\n    throw new Error(\n      `Please set initialization Dependency Injection configuration.`,\n    )\n  }\n\n  inject(module, dependencies = [], initCallback) {\n    const moduleName = module.name\n    const beforeDependencies = module._dependencies || []\n    const dependence = [...new Set(beforeDependencies.concat(dependencies))]\n    const initialize = async (...injected) => {\n      const isAsyncModuleCallback =\n        is.AsyncFunction(module._callback) || is.Promise(module._callback)\n      const isAsyncInitCallback =\n        is.AsyncFunction(initCallback) || is.Promise(initCallback)\n      const isAsync =\n        is.AsyncFunction(module.prototype.initialize) ||\n        is.Promise(module.prototype.initialize)\n      let result\n      if (isAsyncModuleCallback) {\n        await module._callback(\n          ...this._filter(injected, dependence, beforeDependencies),\n        )\n      } else {\n        module._callback &&\n          module._callback(\n            ...this._filter(injected, dependence, beforeDependencies),\n          )\n      }\n      if (isAsync) {\n        result = await new Promise(initCallback => new module({ initCallback }))\n      } else {\n        result = new module()\n      }\n      this.injector(result, dependence, injected)\n      if (isAsyncInitCallback) {\n        await initCallback(\n          ...this._filter(injected, dependence, dependencies),\n          result,\n        )\n      } else {\n        initCallback &&\n          initCallback(\n            ...this._filter(injected, dependence, dependencies),\n            result,\n          )\n      }\n      return result\n    }\n    this._modules.push({\n      moduleName,\n      dependence,\n      initialize,\n    })\n    this._module[moduleName] = module\n    return this\n  }\n\n  injector(result, dependence, injected) {\n    dependence.map((item, index) => {\n      result[`_${item.toLocaleLowerCase()}`] = injected[index]\n    })\n  }\n\n  async bootstrap() {\n    let initializeList = []\n    this._queue(this._modules, initializeList)\n    for (let i = 0; i < initializeList.length; i++) {\n      for (let j = 0; j < this._modules.length; j++) {\n        const moduleName = initializeList[i]\n        const module = this._modules[j]\n        const isCurrentModule = module.moduleName === moduleName\n        const dependenceModules = module.dependence.map(item => this[item])\n        if (isCurrentModule) {\n          const isAsync =\n            is.AsyncFunction(module.initialize) || is.Promise(module.initialize)\n          if (isAsync) {\n            this[moduleName] = await module.initialize(...dependenceModules)\n          } else {\n            this[moduleName] = module.initialize(...dependenceModules)\n          }\n        }\n      }\n    }\n    return this\n  }\n}\n","// import { log } from '../lib/decorator'\n\nexport default class Module {\n  constructor(...args) {\n    this.initialize(...args)\n  }\n\n  initialize({ initCallBack = () => {} } = {}) {\n    const callback = initCallBack || this._initCallBack\n    if (typeof initCallBack !== \"function\") {\n      throw new Error('\"initCallBack\" must be a function')\n    }\n    return callback(this)\n  }\n\n  _initCallBack() {\n    return this\n  }\n}\n","import DI from \"./DI\"\nimport Module from \"./Module\"\n\nexport default {\n  DI,\n  Module,\n}\n"],"names":["Proxy","target","name","Object","prototype","toString","DI","config","_config","_modules","_module","initialize","bootstrap","then","modules","list","restModules","map","moduleName","dependence","isNoneDependence","length","rest","Set","concat","filter","includes","item","isDepended","push","_queue","injected","dependencie","injectedDependencies","index","module","Error","dependencies","initCallback","beforeDependencies","_dependencies","isAsyncModuleCallback","is","AsyncFunction","_callback","Promise","isAsyncInitCallback","isAsync","result","_this","_filter","injector","toLocaleLowerCase","initializeList","i","j","isCurrentModule","dependenceModules","_this2","Module","initCallBack","callback","_initCallBack"],"mappings":"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"}