{"version":3,"file":"glaive.js","sources":["../lib/isType.js","../src/DI.js","../src/Module.js","../src/index.js"],"sourcesContent":["export default new Proxy(\n  {},\n  {\n    get: (target, name) => value =>\n      value::Object.prototype.toString() === `[object ${name}]`,\n  },\n)\n","import is from \"../lib/isType\"\n\nexport default class DI {\n  constructor(config) {\n    this._config = config\n    this._modules = []\n    this._module = {}\n    this.initialize()\n    this.bootstrap().then()\n  }\n\n  _queue(modules, list) {\n    let restModules = []\n    modules.map(({ moduleName, dependence = [] }) => {\n      const isNoneDependence = dependence.length === 0\n      const rest = [...new Set(dependence.concat(list))].filter(\n        item => !list.includes(item),\n      )\n      const isDepended = rest.length === 0\n      if (isNoneDependence || isDepended) {\n        list.push(moduleName)\n      } else {\n        restModules.push({ moduleName, dependence })\n      }\n    })\n    if (restModules.length > 0) {\n      this._queue(restModules, list)\n    }\n  }\n\n  _filter(injected, dependencie, injectedDependencies) {\n    return dependencie\n      .map((item, index) => ({\n        moduleName: item,\n        module: injected[index],\n      }))\n      .filter(({ moduleName }) => injectedDependencies.includes(moduleName))\n      .map(({ module }) => module)\n  }\n\n  initialize() {\n    throw new Error(\n      `Please set initialization Dependency Injection configuration.`,\n    )\n  }\n\n  inject(module, dependencies = [], initCallback) {\n    const moduleName = module.name\n    const beforeDependencies = module._dependencies || []\n    const dependence = [...new Set(beforeDependencies.concat(dependencies))]\n    const initialize = async (...injected) => {\n      const isAsyncModuleCallback =\n        is.AsyncFunction(module._callback) || is.Promise(module._callback)\n      const isAsyncInitCallback =\n        is.AsyncFunction(initCallback) || is.Promise(initCallback)\n      const isAsync =\n        is.AsyncFunction(module.prototype.initialize) ||\n        is.Promise(module.prototype.initialize)\n      let result\n      if (isAsyncModuleCallback) {\n        await module._callback(\n          ...this._filter(injected, dependence, beforeDependencies),\n        )\n      } else {\n        module._callback &&\n          module._callback(\n            ...this._filter(injected, dependence, beforeDependencies),\n          )\n      }\n      if (isAsync) {\n        result = await new Promise(initCallback => new module({ initCallback }))\n      } else {\n        result = new module()\n      }\n      this.injector(result, dependence, injected)\n      if (isAsyncInitCallback) {\n        await initCallback(\n          ...this._filter(injected, dependence, dependencies),\n          result,\n        )\n      } else {\n        initCallback &&\n          initCallback(\n            ...this._filter(injected, dependence, dependencies),\n            result,\n          )\n      }\n      return result\n    }\n    this._modules.push({\n      moduleName,\n      dependence,\n      initialize,\n    })\n    this._module[moduleName] = module\n    return this\n  }\n\n  injector(result, dependence, injected) {\n    dependence.map((item, index) => {\n      result[`_${item.toLocaleLowerCase()}`] = injected[index]\n    })\n  }\n\n  async bootstrap() {\n    let initializeList = []\n    this._queue(this._modules, initializeList)\n    for (let i = 0; i < initializeList.length; i++) {\n      for (let j = 0; j < this._modules.length; j++) {\n        const moduleName = initializeList[i]\n        const module = this._modules[j]\n        const isCurrentModule = module.moduleName === moduleName\n        const dependenceModules = module.dependence.map(item => this[item])\n        if (isCurrentModule) {\n          const isAsync =\n            is.AsyncFunction(module.initialize) || is.Promise(module.initialize)\n          if (isAsync) {\n            this[moduleName] = await module.initialize(...dependenceModules)\n          } else {\n            this[moduleName] = module.initialize(...dependenceModules)\n          }\n        }\n      }\n    }\n    return this\n  }\n}\n","// import { log } from '../lib/decorator'\n\nexport default class Module {\n  constructor(...args) {\n    this.initialize(...args)\n  }\n\n  initialize({ initCallBack = () => {} } = {}) {\n    const callback = initCallBack || this._initCallBack\n    if (typeof initCallBack !== \"function\") {\n      throw new Error('\"initCallBack\" must be a function')\n    }\n    return callback(this)\n  }\n\n  _initCallBack() {\n    return this\n  }\n}\n","import DI from \"./DI\"\nimport Module from \"./Module\"\n\nexport default {\n  DI,\n  Module,\n}\n"],"names":["Proxy","target","name","Object","prototype","toString","DI","config","_config","_modules","_module","initialize","bootstrap","then","modules","list","restModules","map","moduleName","dependence","isNoneDependence","length","rest","Set","concat","filter","includes","item","isDepended","push","_queue","injected","dependencie","injectedDependencies","index","module","Error","dependencies","initCallback","beforeDependencies","_dependencies","isAsyncModuleCallback","is","AsyncFunction","_callback","Promise","isAsyncInitCallback","isAsync","result","_filter","injector","toLocaleLowerCase","initializeList","i","j","isCurrentModule","dependenceModules","Module","initCallBack","callback","_initCallBack"],"mappings":"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"}