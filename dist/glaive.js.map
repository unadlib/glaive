{"version":3,"file":"glaive.js","sources":["../lib/isType.js","../src/DI.js","../src/Module.js","../lib/decorator.js","../src/index.js"],"sourcesContent":["export default new Proxy(\n  {},\n  {\n    get: (target, name) => value =>\n      value::Object.prototype.toString() === `[object ${name}]`,\n  },\n)\n","import is from \"../lib/isType\"\n\nexport default class DI {\n  constructor(config, callback) {\n    this._config = config\n    this._callback = callback\n    this._modules = []\n    this._module = {}\n    this.initialize()\n    this.bootstrap().then(this::this._complete)\n  }\n\n  _complete() {\n    this._callback && this._callback(this)\n    this.initiated = true\n    return this\n  }\n\n  _queue(modules, list) {\n    let restModules = []\n    modules.map(({ moduleName, dependence = [] }) => {\n      const isNoneDependence = dependence.length === 0\n      const rest = [...new Set(dependence.concat(list))].filter(\n        item => !list.includes(item),\n      )\n      const isDepended = rest.length === 0\n      if (isNoneDependence || isDepended) {\n        list.push(moduleName)\n      } else {\n        restModules.push({ moduleName, dependence })\n      }\n    })\n    if (restModules.length > 0) {\n      this._queue(restModules, list)\n    }\n  }\n\n  _filter(injected, dependence, injectedDependencies) {\n    return dependence\n      .map((item, index) => ({\n        moduleName: item,\n        module: injected[index],\n      }))\n      .filter(({ moduleName }) => injectedDependencies.includes(moduleName))\n      .map(({ module }) => module)\n  }\n\n  initialize() {\n    throw new Error(\n      `Please set initialization Dependency Injection configuration.`,\n    )\n  }\n\n  inject(module, dependencies = [], initCallback) {\n    const moduleName = module.name\n    const beforeDependencies = module._dependencies || []\n    const dependence = [...new Set(beforeDependencies.concat(dependencies))]\n    const initialize = async (...injected) => {\n      const isAsyncModuleCallback =\n        is.AsyncFunction(module._callback) || is.Promise(module._callback)\n      const isAsyncInitCallback =\n        is.AsyncFunction(initCallback) || is.Promise(initCallback)\n      const isAsync =\n        is.AsyncFunction(module.prototype.initialize) ||\n        is.Promise(module.prototype.initialize)\n      let result\n      if (isAsyncModuleCallback) {\n        await module._callback(\n          ...this._filter(injected, dependence, beforeDependencies),\n        )\n      } else {\n        module._callback &&\n          module._callback(\n            ...this._filter(injected, dependence, beforeDependencies),\n          )\n      }\n      if (isAsync) {\n        result = await new Promise(initCallback => new module({ initCallback }))\n      } else {\n        result = new module()\n      }\n      this.injector(result, dependence, injected)\n      if (isAsyncInitCallback) {\n        await initCallback(\n          ...this._filter(injected, dependence, dependencies),\n          result,\n        )\n      } else {\n        initCallback &&\n          initCallback(\n            ...this._filter(injected, dependence, dependencies),\n            result,\n          )\n      }\n      return result\n    }\n    this._modules.push({\n      moduleName,\n      dependence,\n      initialize,\n    })\n    this._module[moduleName] = module\n    return this\n  }\n\n  injector(result, dependence, injected) {\n    dependence.map((item, index) => {\n      result[`_${item.toLocaleLowerCase()}`] = injected[index]\n    })\n  }\n\n  async bootstrap() {\n    let initializeList = []\n    this._queue(this._modules, initializeList)\n    for (let i = 0; i < initializeList.length; i++) {\n      for (let j = 0; j < this._modules.length; j++) {\n        const moduleName = initializeList[i]\n        const module = this._modules[j]\n        const isCurrentModule = module.moduleName === moduleName\n        const dependenceModules = module.dependence.map(item => this[item])\n        if (isCurrentModule) {\n          const isAsync =\n            is.AsyncFunction(module.initialize) || is.Promise(module.initialize)\n          if (isAsync) {\n            this[moduleName] = await module.initialize(...dependenceModules)\n          } else {\n            this[moduleName] = module.initialize(...dependenceModules)\n          }\n        }\n      }\n    }\n    return this\n  }\n}\n","// import { log } from '../lib/decorator'\n\nexport default class Module {\n  constructor(...args) {\n    this.initialize(...args)\n  }\n\n  initialize({ initCallBack = () => {} } = {}) {\n    const callback = initCallBack || this._initCallBack\n    if (typeof initCallBack !== \"function\") {\n      throw new Error('\"initCallBack\" must be a function')\n    }\n    return callback(this)\n  }\n\n  _initCallBack() {\n    return this\n  }\n}\n","const depend = (dependencies = [], callback) => target => {\n  target._dependencies = dependencies\n  target._callback = callback\n}\n\nexport { depend as default }\n","import DI from './DI'\nimport Module from './Module'\nimport depend from '../lib/decorator'\n\nexport default {\n  DI,\n  Module,\n  depend,\n}\n\nexport { DI, Module, depend }\n"],"names":["Proxy","target","name","Object","prototype","toString","DI","config","callback","_config","_callback","_modules","_module","initialize","bootstrap","then","_complete","initiated","modules","list","restModules","map","moduleName","dependence","isNoneDependence","length","rest","Set","concat","filter","includes","item","isDepended","push","_queue","injected","injectedDependencies","index","module","Error","dependencies","initCallback","beforeDependencies","_dependencies","isAsyncModuleCallback","is","AsyncFunction","Promise","isAsyncInitCallback","isAsync","result","_filter","injector","toLocaleLowerCase","initializeList","i","j","isCurrentModule","dependenceModules","Module","initCallBack","_initCallBack","depend"],"mappings":"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"}