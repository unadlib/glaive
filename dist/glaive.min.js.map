{"version":3,"file":"glaive.min.js","sources":["../lib/isType.js","../src/DI.js","../src/Module.js","../lib/decorator.js","../src/index.js"],"sourcesContent":["export default new Proxy(\n  {},\n  {\n    get: (target, name) => value =>\n      value::Object.prototype.toString() === `[object ${name}]`,\n  },\n)\n","import is from \"../lib/isType\"\n\nexport default class DI {\n  constructor(config, callback) {\n    this._config = config\n    this._callback = callback\n    this._modules = []\n    this._module = {}\n    this.initialize()\n    this.bootstrap().then(this::this._complete)\n  }\n\n  _complete() {\n    this._callback && this._callback(this)\n    this.initiated = true\n    return this\n  }\n\n  _queue(modules, list) {\n    let restModules = []\n    modules.map(({ moduleName, dependence = [] }) => {\n      const isNoneDependence = dependence.length === 0\n      const rest = [...new Set(dependence.concat(list))].filter(\n        item => !list.includes(item),\n      )\n      const isDepended = rest.length === 0\n      if (isNoneDependence || isDepended) {\n        list.push(moduleName)\n      } else {\n        restModules.push({ moduleName, dependence })\n      }\n    })\n    if (restModules.length > 0) {\n      this._queue(restModules, list)\n    }\n  }\n\n  _filter(injected, dependence, injectedDependencies) {\n    return dependence\n      .map((item, index) => ({\n        moduleName: item,\n        module: injected[index],\n      }))\n      .filter(({ moduleName }) => injectedDependencies.includes(moduleName))\n      .map(({ module }) => module)\n  }\n\n  initialize() {\n    throw new Error(\n      `Please set initialization Dependency Injection configuration.`,\n    )\n  }\n\n  inject(module, dependencies = [], initCallback) {\n    const moduleName = module.name\n    const beforeDependencies = module._dependencies || []\n    const dependence = [...new Set(beforeDependencies.concat(dependencies))]\n    const initialize = async (...injected) => {\n      const isAsyncModuleCallback =\n        is.AsyncFunction(module._callback) || is.Promise(module._callback)\n      const isAsyncInitCallback =\n        is.AsyncFunction(initCallback) || is.Promise(initCallback)\n      const isAsync =\n        is.AsyncFunction(module.prototype.initialize) ||\n        is.Promise(module.prototype.initialize)\n      let result\n      if (isAsyncModuleCallback) {\n        await module._callback(\n          ...this._filter(injected, dependence, beforeDependencies),\n        )\n      } else {\n        module._callback &&\n          module._callback(\n            ...this._filter(injected, dependence, beforeDependencies),\n          )\n      }\n      if (isAsync) {\n        result = await new Promise(initCallback => new module({ initCallback }))\n      } else {\n        result = new module()\n      }\n      this.injector(result, dependence, injected)\n      if (isAsyncInitCallback) {\n        await initCallback(\n          ...this._filter(injected, dependence, dependencies),\n          result,\n        )\n      } else {\n        initCallback &&\n          initCallback(\n            ...this._filter(injected, dependence, dependencies),\n            result,\n          )\n      }\n      return result\n    }\n    this._modules.push({\n      moduleName,\n      dependence,\n      initialize,\n    })\n    this._module[moduleName] = module\n    return this\n  }\n\n  injector(result, dependence, injected) {\n    dependence.map((item, index) => {\n      result[`_${item.toLocaleLowerCase()}`] = injected[index]\n    })\n  }\n\n  async bootstrap() {\n    let initializeList = []\n    this._queue(this._modules, initializeList)\n    for (let i = 0; i < initializeList.length; i++) {\n      for (let j = 0; j < this._modules.length; j++) {\n        const moduleName = initializeList[i]\n        const module = this._modules[j]\n        const isCurrentModule = module.moduleName === moduleName\n        const dependenceModules = module.dependence.map(item => this[item])\n        if (isCurrentModule) {\n          const isAsync =\n            is.AsyncFunction(module.initialize) || is.Promise(module.initialize)\n          if (isAsync) {\n            this[moduleName] = await module.initialize(...dependenceModules)\n          } else {\n            this[moduleName] = module.initialize(...dependenceModules)\n          }\n        }\n      }\n    }\n    return this\n  }\n}\n","// import { log } from '../lib/decorator'\n\nexport default class Module {\n  constructor(...args) {\n    this.initialize(...args)\n  }\n\n  initialize({ initCallBack = () => {} } = {}) {\n    const callback = initCallBack || this._initCallBack\n    if (typeof initCallBack !== \"function\") {\n      throw new Error('\"initCallBack\" must be a function')\n    }\n    return callback(this)\n  }\n\n  _initCallBack() {\n    return this\n  }\n}\n","const depend = (dependencies = [], callback) => target => {\n  target._dependencies = dependencies\n  target._callback = callback\n}\n\nexport { depend as default }\n","import DI from \"./DI\"\nimport Module from \"./Module\"\nimport depend from \"../lib/decorator\"\n\nexport default {\n  DI,\n  Module,\n  depend,\n}\n\nexport { DI, Module, depend }\n"],"names":["Proxy","target","name","Object","prototype","toString","DI","config","callback","_config","_callback","_modules","_module","initialize","bootstrap","then","_complete","initiated","modules","list","restModules","map","moduleName","dependence","isNoneDependence","length","rest","Set","concat","filter","includes","item","isDepended","push","_queue","injected","injectedDependencies","index","module","Error","dependencies","initCallback","beforeDependencies","_dependencies","isAsyncModuleCallback","is","AsyncFunction","Promise","isAsyncInitCallback","isAsync","result","_this","_filter","injector","toLocaleLowerCase","initializeList","i","j","isCurrentModule","dependenceModules","_this2","Module","initCallBack","_initCallBack","depend"],"mappings":"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"}